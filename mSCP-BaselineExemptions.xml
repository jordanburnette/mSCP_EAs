<?xml version="1.0" encoding="UTF-8"?>
<extensionAttribute>
<displayName>mSCP - Baseline Exemptions</displayName>
<displayInCategory>Operating System</displayInCategory>
<dataType>string</dataType>
<description>Displays a list of exempted compliance controls</description>
<dataType>string</dataType>
<scriptContentsMac>#!/bin/sh
######
# mSCP-BaselineExemptions.sh
# Written by Jordan Burnette (jburnette@vcu.edu)
# Last modified 2022.09.28 by Jordan Burnette
# https://github.com/jordanburnette/mSCP_EAs
###### Description
# Determines the baseline version being used and lists out any exemptions that are deployed to the machine. 
######

audit=$(ls -l /Library/Preferences | /usr/bin/grep 'org.*.audit.plist' | /usr/bin/awk '{print $NF}')

if [[ ! -z "$audit" ]]; then

	count=$(echo "$audit" | wc -l | xargs)
	if [[ "$count" == 1 ]]; then
		auditFile="/Library/Managed Preferences/${audit}"
		if [[ ! -e "$auditFile" ]];then
				auditFile="/Library/Preferences/${audit}"	
		fi
		/usr/bin/plutil -convert xml1 "${auditFile}"

		if [[ $(/usr/bin/grep "<key>exempt</key>" "${auditFile}" 2> /dev/null) ]] ; then
			result="$(/usr/bin/defaults read "${auditFile}" 2> /dev/null | /usr/bin/grep -B3 "exempt = 1" | /usr/bin/grep "{" | /usr/bin/cut -d '"' -f2)"
		else
			result="No Exemptions Set"
		fi
	else
		result="Multiple Baselines Found"
	fi
else 
	result="No Baseline Found"
fi

/bin/echo "&lt;result&gt;${result}&lt;/result&gt;"
</scriptContentsMac>
</extensionAttribute>
